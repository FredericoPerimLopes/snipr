# Task 003: File System Monitoring and Change Detection

## Metadata
```yaml
epic: semantic-code-retrieval
batch: core-infrastructure
priority: high
effort_estimate: 1-2 days
created: 2025-09-01T12:54:42Z
updated: 2025-09-01T12:54:42Z
status: pending
assignee: null
parallel: [001, 002, 004]
depends_on: []
blocks: [005, 006]
```

## Summary
Implement real-time file system monitoring to detect code changes and trigger incremental re-indexing, ensuring the semantic index stays synchronized with the codebase.

## Objectives
- Monitor file system changes using efficient OS-native APIs
- Implement intelligent filtering for relevant file types
- Create change queue with batching and debouncing
- Handle edge cases (renames, moves, deletions)
- Optimize for large repositories with many files

## Technical Requirements

### Monitoring Architecture
```rust
pub struct FileSystemMonitor {
    watcher: RecommendedWatcher,
    change_queue: Arc<Mutex<VecDeque<FileChange>>>,
    config: MonitorConfig,
    filters: Vec<Box<dyn FileFilter>>,
}

pub enum FileChange {
    Created(PathBuf),
    Modified(PathBuf),
    Deleted(PathBuf),
    Renamed { from: PathBuf, to: PathBuf },
}

pub struct MonitorConfig {
    watch_paths: Vec<PathBuf>,
    ignore_patterns: Vec<Glob>,
    debounce_duration: Duration,
    batch_size: usize,
    max_queue_size: usize,
}
```

### Change Detection Features
- Real-time file system event monitoring
- Intelligent debouncing (300ms default)
- Batch processing of multiple changes
- Git-aware filtering (.gitignore integration)
- Language-specific file type filtering
- Directory traversal optimization

### Performance Optimizations
- Efficient event filtering at OS level
- Configurable watch depth limits
- Memory-bounded change queues
- Batch processing for burst changes
- Symlink handling and cycle detection

### Platform Support
- Linux: inotify integration
- macOS: FSEvents integration  
- Windows: ReadDirectoryChangesW integration
- Cross-platform abstraction layer

## Acceptance Criteria
- [ ] Real-time monitoring works across all target platforms
- [ ] Git ignore patterns properly respected
- [ ] Debouncing prevents excessive re-indexing during rapid changes
- [ ] Change queue handles burst scenarios without memory issues
- [ ] Monitoring can be paused/resumed programmatically
- [ ] File renames and moves tracked correctly
- [ ] Large repository monitoring (50k+ files) performs efficiently
- [ ] Integration with indexing engine for triggered updates

## Implementation Notes
- Use notify crate for cross-platform file watching
- Implement custom filters for common ignore patterns
- Add configuration for watch sensitivity and batch timing
- Handle temporary files and editor swap files gracefully
- Implement graceful shutdown and cleanup

## Definition of Done
- File system monitoring works reliably across platforms
- Change detection integrates seamlessly with indexing pipeline
- Performance acceptable for repositories with 100k+ files
- Comprehensive test suite covers edge cases
- Monitoring overhead is minimal (< 5% CPU during idle)